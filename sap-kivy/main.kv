#:kivy 1.9.1

<MainScreen>:
    id: main_screen
    reset_flow_popup: reset_flow_popup.__self__

    LabelStatus:
        size_hint: None, None
        height: main_tabbed_panel.tab_height
        width: 125
        pos: main_tabbed_panel.width - self.width - 2, main_tabbed_panel.height - self.height - 2
        font_size: '17sp'
        bstate: app.arduino.system_status

    TabbedPanel:
        id: main_tabbed_panel
        size_hint: 1, 1
        do_default_tab: False
        on_children: main_tabbed_panel.switch_to(main)

        TabbedPanelItem:
            text: 'Main'
            id: main

            BoxLayout:
                orientation: 'vertical'
                padding: 10
                spacing: 10

                GridLayout:
                    id: flow_layout
                    rows: 1
                    cols: 3
                    size_hint: 1, 0.6
                    padding: 0, 0, 0, 0
                    spacing: 20

                    FlowCluster:
                        flow: app.arduino.sap_flow
                        gallons: app.arduino.sap_gallons

                    FlowCluster:
                        flow: app.arduino.water_flow
                        gallons: app.arduino.water_gallons

                    FlowCluster:
                        flow: app.arduino.total_flow
                        gallons: app.arduino.total_gallons

                BoxLayout:
                    orientation: 'horizontal'
                    size_hint: 1, 0.2

                    Label:
                        text: '[size=30]Efficiency: [/size]' + app.arduino.efficiency + '[size=25] %[/size]'
                        font_size: '45sp'
                        markup: 'True'

                GridLayout:
                    id: main_buttons_layout
                    rows: 1
                    cols: 6
                    size_hint: 1, .2

                    MainButton:
                        text: 'Enable'
                        on_release: app.arduino.set('digital_output/enable/1')

                    MainButton:
                        text: 'Run Auto'
                        on_release: app.arduino.set('run_auto/1')

                    MainButton:
                        text: 'Stop'
                        on_release: app.arduino.set('run_auto/0')

                    MainButton:
                        text: 'Reset'
                        on_release: reset_flow_popup.open()

                    Popup:
                        id: reset_flow_popup
                        title: "Reset"
                        size_hint: None, None
                        size: 300, 300
                        on_parent:
                            if self.parent == main_buttons_layout: self.parent.remove_widget(self)

                        BoxLayout:
                            orientation: 'vertical'

                            Label:
                                text: 'Are you sure you want to reset flows?'
                                size_hint: 1, .8
                                text_size: self.width, None
                                height: self.texture_size[1]
                                font_size: '18sp'

                            GridLayout:
                                rows: 1
                                cols: 2
                                size_hint: 1, .2

                                Button:
                                    text: 'Yes'
                                    on_release: app.arduino.set('flow_config/reset_sap/0'); app.arduino.set('flow_config/reset_water/0')

                                Button:
                                    text: 'Cancel'
                                    on_release: reset_flow_popup.dismiss()

        TabbedPanelItem:
            text: 'Manual'
            id: manuel

            GridLayout:
                rows: 1
                cols: 3
                spacing: 30

                GridLayout:
                    id: manual_layout
                    rows: 4
                    cols: 1
                    padding: 60, 60, 12, 0
                    spacing: 25

                    Button:
                        text: 'Test'

                    Button:
                        text: 'Test'


<MainButton@Button>:
    font_size: '20sp'

<PumpState@LabelB>:
    font_size: '18sp'
    markup: 'True'
    #bcolor_on: 0.19, 0.64, 0.8, 1
    bcolor_on: 0.03, 0.55, 0.07, 1
    bcolor_off: 0.34, 0.34, 0.34, 1
